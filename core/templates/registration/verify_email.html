{% extends "./auth.html" %}
{% load static %}

{% block content %}
<body class="bg-body-secondary d-flex align-items-center justify-content-center vh-100">
    <div class="login-box">
        <div class="card shadow-lg rounded-4">
            <div class="card-body login-card-body p-4">
                <h4 class="text-center mb-3">Verify Your Email</h4>
                <p class="text-center text-muted mb-4">
                    Enter your email and code below.
                </p>

                <form method="post" action="{% url 'core:verify_email' %}" id="verify-form">
                    {% csrf_token %}

                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Email address</label>
                        <input type="email" name="email" class="form-control" required placeholder="Enter your email">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Verification Code</label>
                        <input type="text" name="code" class="form-control" required placeholder="Enter code">
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2">Verify</button>
                </form>

                <p class="mt-4 text-center">
                    Already verified? <a href="{% url 'core:login' %}">Login</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Automatically fill the verification token from the URL if present
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const token = params.get("token");
            if (token) {
                const form = document.getElementById("verify-form");
                const codeInput = form.querySelector('input[name="code"]');
                if(codeInput) {
                    codeInput.value = token;
                    form.submit();  // automatically submit
                }
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
</body>
{% endblock %}
