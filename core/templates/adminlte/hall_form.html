{% extends "./adminlteBase.html" %}
{% load static %}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>

{% block content %}

<!--begin::App Content Header-->
<div class="app-content-header">
    <!--begin::Container-->
    <div class="container-fluid">
        <!--begin::Row-->
        <div class="row">
            <div class="col-sm-6"><h3 class="mb-0">Hall Creation</h3></div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Hall Creation</li>
                </ol>
            </div>
        </div>
        <!--end::Row-->
    </div>
    <!--end::Container-->
</div>
<!--end::App Content Header-->
<!--begin::App Content-->
<div class="app-content">
    <!--begin::Container-->
    <div class="container-fluid">
        <!--begin::Row-->
        <div class="row g-4">
            <!--begin::Col-->
            <div class="col-md-12">
                <!--begin::Form Validation-->
                <div class="card card-info card-outline mb-4">
                    <!--begin::Form-->
                    <form method="post" class="needs-validation" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!--begin::Body-->
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Hall Fields -->
                                <div class="col-md-6">
                                    {{ hall_form.name.label_tag }}
                                    {{ hall_form.name }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.price.label_tag }}
                                    {{ hall_form.price }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.location.label_tag }}
                                    {{ hall_form.location }}
                                </div>

                                <div class="col-md-6">
                                    {{ hall_form.capacity.label_tag }}
                                    {{ hall_form.capacity }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.batch.label_tag }}
                                    {{ hall_form.batch }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.area_size.label_tag }}
                                    {{ hall_form.area_size }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.parking_capacity.label_tag }}
                                    {{ hall_form.parking_capacity }}
                                </div>
                                <div class="col-md-6">
                                    {{ hall_form.year_built.label_tag }}
                                    {{ hall_form.year_built }}
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        {{ hall_form.is_government_property }}
                                        {{ hall_form.is_government_property.label_tag }}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    {{ hall_form.description.label_tag }}
                                    {{ hall_form.description }}
                                </div>
                            </div>

                            <!--begin::Rent Info-->
                            <h5 class="mt-5">Rent Info</h5>
                            <div id="rent-forms">
                                {{ rent_formset.management_form }}
                                {% for rent_form in rent_formset %}
                                {% include "adminlte/rent_form.html" with rent_form=rent_form %}
                                {% endfor %}
                            </div>

                            <button type="button"
                                    class="btn btn-outline-primary"
                                    id="add-rent-btn"
                                    hx-get="{% url 'services:rent_form_partial' %}?form_index={{ rent_formset.total_form_count }}"
                                    hx-include="#rent-forms"
                                    hx-target="#rent-forms"
                                    hx-swap="beforeend">
                                + Add Rent Info
                            </button>
                            <script>
                                let formIndex = {{ rent_formset.total_form_count }};

                                document.body.addEventListener('htmx:afterSwap', function(evt) {
                                    if (evt.target.id === "rent-forms") {
                                        formIndex++;
                                        document.getElementById('id_form-TOTAL_FORMS').value = formIndex;
                                    }
                                });
                            </script>
                            <hr>
                            <!--end::Rent Info-->

                            <!--begin::Hall Images-->
                            <h5 class="mt-5">Hall Images</h5>
                            <div id="hall-images-forms">
                                {{ hall_images_formset.management_form }}
                                {% for hall_image_form in hall_images_formset %}
                                {% include "adminlte/hall_images_form.html" with hall_image_form=hall_image_form %}
                                {% endfor %}
                            </div>

                            <button type="button"
                                    class="btn btn-outline-primary"
                                    id="add-hall-image-btn"
                                    hx-get="{% url 'services:hall_image_form_partial' %}?form_index={{ hall_image_formset.total_form_count }}"
                                    hx-include="#hall-images-forms"
                                    hx-target="#hall-images-forms"
                                    hx-swap="beforeend">
                                + Add Hall Images
                            </button>
                            <script>
                                let formIndex = {{ rent_formset.total_form_count }};

                                document.body.addEventListener('htmx:afterSwap', function(evt) {
                                    if (evt.target.id === "rent-forms") {
                                        formIndex++;
                                        document.getElementById('id_form-TOTAL_FORMS').value = formIndex;
                                    }
                                });
                            </script>
                            <hr>
                            <!--end::Hall Images-->
                        </div>
                        <!--end::Body-->
                        <!--begin::Footer-->
                        <div class="card-footer">
                            <button class="btn btn-info" type="submit">Submit form</button>
                        </div>
                        <!--end::Footer-->
                    </form>
                    <!--end::Form-->

                    <!--begin::JavaScript-->
                    <script>
                        // Example starter JavaScript for disabling form submissions if there are invalid fields
                        (() => {
                          'use strict';

                          // Fetch all the forms we want to apply custom Bootstrap validation styles to
                          const forms = document.querySelectorAll('.needs-validation');

                          // Loop over them and prevent submission
                          Array.from(forms).forEach((form) => {
                            form.addEventListener(
                              'submit',
                              (event) => {
                                if (!form.checkValidity()) {
                                  event.preventDefault();
                                  event.stopPropagation();
                                }

                                form.classList.add('was-validated');
                              },
                              false,
                            );
                          });
                        })();
                    </script>
                    <!--end::JavaScript-->
                </div>
                <!--end::Form Validation-->
            </div>
            <!--end::Col-->
        </div>
        <!--end::Row-->
    </div>
    <!--end::Container-->
</div>
<!--end::App Content-->


{% endblock %}